<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Confirm Example - Tiny UI Components</title>
    <style>
    * {
      padding: 0;
      margin: 0;
    }
    html,body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      -ms-touch-action: none;
      touch-action: none;
    }
    canvas {
      -ms-touch-action: none;
      touch-action: none;
      touch-action-delay: none;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
      -moz-tap-highlight-color: rgba(0,0,0,0);
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      outline: none;
      border: none;
      width: 100%;
      height: 100%;
    }
    #info {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      border-radius: 4px;
      pointer-events: none;
      z-index: 1000;
    }
    </style>
  </head>
  <body>
    <div id="info">
      <div>Confirm Demo (DPR: <span id="dpr">1</span>x)</div>
      <div>Click buttons to open dialogs</div>
    </div>
    <canvas id="game"></canvas>
    <script src="/core/dist/tiny-ui-core.js"></script>
    <script src="/components/dist/tiny-ui-components.js"></script>
    <script>
    const canvas = document.getElementById('game');
    const tinyUI = new TinyUI(canvas);
    const { Confirm, TextBtn } = TinyUIComponents;
    const { adjustTo } = TinyUIComponents.utils;

    // DPR scaling
    const dpr = window.devicePixelRatio || 1;
    document.getElementById('dpr').textContent = dpr.toFixed(1);
    const scale = (val) => val * Math.min(dpr, 2);

    // Sizes
    const fontSize = {
      title: scale(36),
      label: scale(20)
    };
    
    const btnSize = {
      standard: { w: scale(200), h: scale(60) },
      small: { w: scale(100), h: scale(45) }
    };

    // 背景
    const bg = tinyUI.createGraphics();
    bg.drawRect(0, 0, tinyUI.stageWidth, tinyUI.stageHeight, '#f1f5f9');
    tinyUI.root.addChild(bg);
    adjustTo(tinyUI.root, true)(bg, { h: 'left', v: 'top' });

    // 标题
    const title = tinyUI.createText('Confirm Component Demo');
    title.color = '#333333';
    title.fontSize = fontSize.title;
    title.updateTexture();
    tinyUI.root.addChild(title);
    adjustTo(tinyUI.root, true)(title, { h: 'center', v: 'top' }, { y: scale(50) });

    // ========== 示例1: 基本确认弹窗 ==========
    const label1 = tinyUI.createText('1. Basic Confirm Dialog');
    label1.color = '#666666';
    label1.fontSize = fontSize.label;
    label1.updateTexture();
    tinyUI.root.addChild(label1);
    adjustTo(title, false)(label1, { h: 'center', v: 'bottom' }, { y: fontSize.label + scale(30) });

    const { container: btn1 } = TextBtn({
      app: tinyUI,
      text: 'Open Basic Confirm',
      bgColor: '#3b82f6',
      width: btnSize.standard.w,
      height: btnSize.standard.h,
      fontSize: fontSize.label,
      onClick: () => {
        const images = createVirtualImages();
        
        Promise.all(images.map(img => loadImage(img))).then(loadedImgs => {
          const confirmDialog = Confirm({
            app: tinyUI,
            stageSize: { width: tinyUI.stageWidth, height: tinyUI.stageHeight },
            contentSize: { width: scale(500), height: scale(400) },
            imgs: {
              bg: loadedImgs[0],
              contentBg: loadedImgs[1],
              title: loadedImgs[2],
              contents: [loadedImgs[3], loadedImgs[4]],
              btnPrev: loadedImgs[5],
              btnNext: loadedImgs[6],
              btnOK: loadedImgs[7]
            },
            onOK: (result) => {
              result.container.destroy();
              requestAnimationFrame(() => tinyUI.render());
              alert('Confirmed!');
            },
            opt: {
              titleScale: 0.8,
              btnScale: 0.7,
              bgAlpha: 0.85
            }
          });
          
          tinyUI.root.addChild(confirmDialog.container);
          // 居中显示弹窗
          confirmDialog.container.x = tinyUI.stageWidth / 2;
          confirmDialog.container.y = tinyUI.stageHeight / 2;
          confirmDialog.container.anchorX = 0.5;
          confirmDialog.container.anchorY = 0.5;
          
          requestAnimationFrame(() => tinyUI.render());
        });
      }
    });
    tinyUI.root.addChild(btn1);
    adjustTo(label1, false)(btn1, { h: 'center', v: 'bottom' }, { y: btnSize.standard.h + scale(15) });

    // ========== 示例2: 带取消按钮的确认弹窗 ==========
    const label2 = tinyUI.createText('2. Confirm with Cancel');
    label2.color = '#666666';
    label2.fontSize = fontSize.label;
    label2.updateTexture();
    tinyUI.root.addChild(label2);
    adjustTo(btn1, false)(label2, { h: 'center', v: 'bottom' }, { y: fontSize.label + scale(30) });

    const { container: btn2 } = TextBtn({
      app: tinyUI,
      text: 'Open with Cancel',
      bgColor: '#10b981',
      width: btnSize.standard.w,
      height: btnSize.standard.h,
      fontSize: fontSize.label,
      onClick: () => {
        const images = createVirtualImages();
        
        Promise.all(images.map(img => loadImage(img))).then(loadedImgs => {
          const confirmDialog = Confirm({
            app: tinyUI,
            stageSize: { width: tinyUI.stageWidth, height: tinyUI.stageHeight },
            contentSize: { width: scale(500), height: scale(400) },
            imgs: {
              bg: loadedImgs[0],
              contentBg: loadedImgs[1],
              title: loadedImgs[2],
              contents: [loadedImgs[3]],
              btnPrev: loadedImgs[5],
              btnNext: loadedImgs[6],
              btnOK: loadedImgs[7],
              btnCancel: loadedImgs[8]
            },
            onOK: (result) => {
              result.container.destroy();
              requestAnimationFrame(() => tinyUI.render());
              alert('OK clicked!');
            },
            onCancel: (result) => {
              result.container.destroy();
              requestAnimationFrame(() => tinyUI.render());
              alert('Cancel clicked!');
            },
            opt: {
              titleScale: 0.8,
              btnScale: 0.7,
              bgAlpha: 0.9
            }
          });
          
          tinyUI.root.addChild(confirmDialog.container);
          // 居中显示弹窗
          confirmDialog.container.x = tinyUI.stageWidth / 2;
          confirmDialog.container.y = tinyUI.stageHeight / 2;
          confirmDialog.container.anchorX = 0.5;
          confirmDialog.container.anchorY = 0.5;
          
          requestAnimationFrame(() => tinyUI.render());
        });
      }
    });
    tinyUI.root.addChild(btn2);
    adjustTo(label2, false)(btn2, { h: 'center', v: 'bottom' }, { y: btnSize.standard.h + scale(15) });

    // ========== 示例3: 不同配置的确认弹窗 ==========
    const label3 = tinyUI.createText('3. Different Configurations');
    label3.color = '#666666';
    label3.fontSize = fontSize.label;
    label3.updateTexture();
    tinyUI.root.addChild(label3);
    adjustTo(btn2, false)(label3, { h: 'center', v: 'bottom' }, { y: fontSize.label + scale(30) });

    // 使用一个容器来包裹三个按钮，方便布局
    const { container: btn3 } = TextBtn({
      app: tinyUI,
      text: 'Small',
      bgColor: '#f59e0b',
      width: btnSize.small.w,
      height: btnSize.small.h,
      fontSize: fontSize.label,
      onClick: () => openConfirmWithConfig(0.6, 0.5)
    });
    tinyUI.root.addChild(btn3);
    // 三个按钮都相对于 label3 水平居中，通过 x 偏移实现均匀分布
    adjustTo(label3, false)(btn3, { h: 'center', v: 'bottom' }, { x: -scale(140), y: btnSize.small.h + scale(15) });

    const { container: btn4 } = TextBtn({
      app: tinyUI,
      text: 'Normal',
      bgColor: '#f59e0b',
      width: btnSize.small.w,
      height: btnSize.small.h,
      fontSize: fontSize.label,
      onClick: () => openConfirmWithConfig(0.8, 0.7)
    });
    tinyUI.root.addChild(btn4);
    adjustTo(label3, false)(btn4, { h: 'center', v: 'bottom' }, { y: btnSize.small.h + scale(15) });

    const { container: btn5 } = TextBtn({
      app: tinyUI,
      text: 'Large',
      bgColor: '#f59e0b',
      width: btnSize.small.w,
      height: btnSize.small.h,
      fontSize: fontSize.label,
      onClick: () => openConfirmWithConfig(1.0, 0.9)
    });
    tinyUI.root.addChild(btn5);
    adjustTo(label3, false)(btn5, { h: 'center', v: 'bottom' }, { x: scale(140), y: btnSize.small.h + scale(15) });

    function openConfirmWithConfig(titleScale, btnScale) {
      const images = createVirtualImages();
      
      Promise.all(images.map(img => loadImage(img))).then(loadedImgs => {
        const confirmDialog = Confirm({
          app: tinyUI,
          stageSize: { width: tinyUI.stageWidth, height: tinyUI.stageHeight },
          contentSize: { width: scale(500), height: scale(400) },
          imgs: {
            bg: loadedImgs[0],
            contentBg: loadedImgs[1],
            title: loadedImgs[2],
            contents: [loadedImgs[3]],
            btnPrev: loadedImgs[5],
            btnNext: loadedImgs[6],
            btnOK: loadedImgs[7]
          },
          onOK: (result) => {
            result.container.destroy();
            requestAnimationFrame(() => tinyUI.render());
          },
          opt: {
            titleScale: titleScale,
            btnScale: btnScale,
            bgAlpha: 0.85,
            padding: scale(20)
          }
        });
        
        tinyUI.root.addChild(confirmDialog.container);
        // 居中显示弹窗
        confirmDialog.container.x = tinyUI.stageWidth / 2;
        confirmDialog.container.y = tinyUI.stageHeight / 2;
        confirmDialog.container.anchorX = 0.5;
        confirmDialog.container.anchorY = 0.5;
        
        requestAnimationFrame(() => tinyUI.render());
      });
    }

    // ========== 示例4: 多页内容 ==========
    const label4 = tinyUI.createText('4. Multi-page Content');
    label4.color = '#666666';
    label4.fontSize = fontSize.label;
    label4.updateTexture();
    tinyUI.root.addChild(label4);
    // 基于 label3 定位（居中）
    adjustTo(label3, false)(label4, { h: 'center', v: 'bottom' }, { y: fontSize.label + scale(80) });

    const { container: btn6 } = TextBtn({
      app: tinyUI,
      text: 'Open Multi-page',
      bgColor: '#8b5cf6',
      width: btnSize.standard.w,
      height: btnSize.standard.h,
      fontSize: fontSize.label,
      onClick: () => {
        const images = createVirtualImages();
        
        Promise.all(images.map(img => loadImage(img))).then(loadedImgs => {
          const confirmDialog = Confirm({
            app: tinyUI,
            stageSize: { width: tinyUI.stageWidth, height: tinyUI.stageHeight },
            contentSize: { width: scale(500), height: scale(400) },
            imgs: {
              bg: loadedImgs[0],
              contentBg: loadedImgs[1],
              title: loadedImgs[2],
              contents: [
                loadedImgs[3], 
                loadedImgs[4],
                createColoredImage(scale(200), scale(150), '#ef4444'),
                createColoredImage(scale(200), scale(150), '#10b981'),
                createColoredImage(scale(200), scale(150), '#3b82f6')
              ],
              btnPrev: loadedImgs[5],
              btnNext: loadedImgs[6],
              btnOK: loadedImgs[7]
            },
            onOK: (result) => {
              result.container.destroy();
              requestAnimationFrame(() => tinyUI.render());
            },
            opt: {
              titleScale: 0.8,
              btnScale: 0.7,
              bgAlpha: 0.85
            }
          });
          
          tinyUI.root.addChild(confirmDialog.container);
          // 居中显示弹窗
          confirmDialog.container.x = tinyUI.stageWidth / 2;
          confirmDialog.container.y = tinyUI.stageHeight / 2;
          confirmDialog.container.anchorX = 0.5;
          confirmDialog.container.anchorY = 0.5;
          
          requestAnimationFrame(() => tinyUI.render());
        });
      }
    });
    tinyUI.root.addChild(btn6);
    adjustTo(label4, false)(btn6, { h: 'center', v: 'bottom' }, { y: btnSize.standard.h + scale(15) });

    // 辅助函数
    function createVirtualImages() {
      const configs = [
        { w: scale(100), h: scale(100), color: '#1e293b', text: 'BG' },
        { w: scale(400), h: scale(300), color: '#ffffff', text: 'Content' },
        { w: scale(200), h: scale(60), color: '#3b82f6', text: 'Title' },
        { w: scale(200), h: scale(150), color: '#f59e0b', text: 'Img1' },
        { w: scale(200), h: scale(150), color: '#10b981', text: 'Img2' },
        { w: scale(60), h: scale(60), color: '#64748b', text: '<' },
        { w: scale(60), h: scale(60), color: '#64748b', text: '>' },
        { w: scale(100), h: scale(50), color: '#3b82f6', text: 'OK' },
        { w: scale(100), h: scale(50), color: '#ef4444', text: 'Cancel' }
      ];
      
      return configs.map(config => createColoredImage(config.w, config.h, config.color, config.text));
    }

    function createColoredImage(width, height, color, text = '') {
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      
      ctx.fillStyle = color;
      ctx.fillRect(0, 0, width, height);
      ctx.strokeStyle = '#000000';
      ctx.lineWidth = 2;
      ctx.strokeRect(0, 0, width, height);
      
      if (text) {
        ctx.fillStyle = '#ffffff';
        ctx.font = `bold ${scale(20)}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(text, width / 2, height / 2);
      }
      
      // 返回 canvas 元素而不是 data URL
      // Canvas 是有效的 CanvasImageSource，可以直接被 WebGL 使用
      return canvas;
    }

    function loadImage(src) {
      return new Promise((resolve) => {
        if (typeof src === 'string' && src.startsWith('data:')) {
          const img = new Image();
          img.onload = () => resolve(img);
          img.src = src;
        } else {
          resolve(src);
        }
      });
    }

    // 将按钮暴露给测试
    window.testButtons = {
      basic: btn1,
      withCancel: btn2,
      small: btn3,
      normal: btn4,
      large: btn5,
      multiPage: btn6
    };

    requestAnimationFrame(() => tinyUI.render());
    </script>
  </body>
</html>
